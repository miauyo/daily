name: Daily Commit

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 9:00 æ‰§è¡Œ (UTC 1:00)
    - cron: '0 1 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  daily-commit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # è·å–å®Œæ•´å†å²è®°å½•
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Configure Git
      run: |
        git config --global user.name "æ™“ä¸œ"
        git config --global user.email "i@miauyo.com"
    
    - name: Daily commit
      run: |
        # è·å–å½“å‰æ—¥æœŸ
        current_date=$(date +%Y-%m-%d)
        current_time=$(date +%H:%M:%S)
        
        # ç”Ÿæˆéšæœºæ•°å†³å®šæ˜¯å¦å¤šæ¬¡æäº¤ (25% æ¦‚ç‡)
        random_chance=$((RANDOM % 100))
        
        if [ $random_chance -lt 25 ]; then
          # éšæœºå¤šæ¬¡æäº¤ (2-4æ¬¡)
          commit_count=$((RANDOM % 3 + 2))
          echo "ğŸ² ä»Šå¤©æ˜¯æ´»è·ƒæ—¥ï¼å°†è¿›è¡Œ $commit_count æ¬¡æäº¤"
          
          for ((i=1; i<=commit_count; i++)); do
            # ç”Ÿæˆéšæœºæ—¶é—´é—´éš”
            sleep_time=$((RANDOM % 10 + 1))
            sleep $sleep_time
            
            # éšæœºé€‰æ‹©æäº¤ç±»å‹
            commit_types=("ğŸ› ä¿®å¤å°é—®é¢˜" "âœ¨ ä»£ç ä¼˜åŒ–" "ğŸ“ æ›´æ–°æ–‡æ¡£" "ğŸ¨ æ ·å¼è°ƒæ•´" "âš¡ æ€§èƒ½æå‡" "ğŸ”§ é…ç½®æ›´æ–°" "âœ… æµ‹è¯•å®Œå–„" "ğŸš€ åŠŸèƒ½æ”¹è¿›")
            type_index=$((RANDOM % ${#commit_types[@]}))
            commit_msg="${commit_types[$type_index]}"
            
            echo "æäº¤ $i/$commit_count: $commit_msg"
            git commit --allow-empty -m "$commit_msg" --date="$(date)"
          done
        else
          # æ­£å¸¸å•æ¬¡æ‰“å¡
          echo "âœ… ä»Šæ—¥æ­£å¸¸æ‰“å¡"
          git commit --allow-empty -m "ğŸ“… æ¯æ—¥æ‰“å¡: $current_date" --date="$(date)"
        fi
    
    - name: Push changes
      run: |
        git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
